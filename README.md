# 逆水寒殿试答题器

专为逆水寒游戏殿试答题设计的智能助手，通过截图快速识别题目，调用AI服务和本地诗词库，为您提供准确答案。

## ✨ 功能特色

- 🎯 **专为殿试设计**: 针对逆水寒殿试题目优化，特别适合诗词类题目
- 📚 **海量诗词库**: 内置超过33万首古典诗词，覆盖历代经典
- ⚡ **多源并行搜索**: AI服务与本地知识库同时工作，答案秒速呈现
- 🖼️ **智能截图识别**: 可调节悬浮窗，精准识别题目文字
- 🤖 **多AI支持**: 兼容OpenAI、豆包、硅基流动等多个AI服务
- 🔍 **高精度OCR**: 支持Tesseract和百度云两种OCR引擎
- 📝 **优化答案显示**: 突出显示答案，减少冗余信息

## ✅ 本地知识库状态

### 📊 数据库信息
- **SQLite数据库**: `poetry.db` (277MB, 334,479条记录)
- **加载数量**: 50,000首经典诗词 (性能优化)
- **触发条件**: 仅针对特定诗词问题格式
- **搜索功能**: 支持字符匹配和内容搜索

### 🎯 支持的问题格式
本地知识库专门响应以下类型的问题：
- "请从以下字中选出一句诗词"
- "请从下列字中选出一句诗词"
- "从以下字中选出一句诗词"
- "用这些字组成一句诗"
- "用下面的字组成诗句"
- "这些字能组成什么诗句"

### 💡 使用示例
- ✅ **会触发**: "请从以下字中选出一句诗词：床前明月光疑是地上霜"
- ❌ **不会触发**: "李白写过什么诗？"
- ✅ **会触发**: "用这些字组成一句诗：春眠不觉晓处处闻啼鸟"

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 使用虚拟环境（推荐）
```bash
# 激活虚拟环境（已配置）
source venv/Scripts/activate    # Windows Git Bash
# 或者直接运行
./start.sh                      # Linux/Mac
start.bat                       # Windows
```

### 3. 准备诗词数据库
**注意：项目已包含完整的诗词数据库 `poetry.db`，无需额外下载！**

如果需要重新构建数据库：
1. 从 [chinese-poetry](https://github.com/chinese-poetry/chinese-poetry) 下载诗词数据
2. 解压到程序目录，文件夹名为 `chinese-poetry-master`
3. 运行数据库生成脚本：
```bash
python consolidate_poetry.py
python split_database.py
```

### 4. 配置服务
启动程序后点击"设置"：

**OCR配置**：
- Tesseract（推荐）：下载安装后配置exe路径
- 百度云OCR：注册获取API密钥

**AI配置**：
- 添加AI服务（OpenAI、豆包等）
- 配置API密钥和模型

## 🎮 使用方法

1. **启动程序**：
   ```bash
   python main.py
   ```

2. **答题流程**：
   - 点击"打开截图区域"
   - 调整区域覆盖题目
   - 点击"截图并识别"
   - 查看AI和本地库答案

3. **殿试技巧**：
   - 诗词题目优先查看本地知识库答案（红色粗体显示）
   - 多个AI答案可供参考对比
   - 答案按相关度排序，优先选择匹配度高的

## 📂 项目结构

```
逆水寒殿试答题器/
├── main.py                    # 主程序
├── ai_manager.py              # AI服务管理
├── knowledge_base_manager.py  # 诗词库管理
├── ocr_manager.py             # 文字识别
├── settings_window.py         # 设置界面
├── screenshot_tool.py         # 截图工具
├── requirements.txt           # 依赖列表
├── poetry.db                  # 诗词数据库
└── README.md                  # 说明文档
```

## ❓ 常见问题

**Q: 诗词搜索很慢？**
A: 确保运行了`split_database.py`脚本来优化数据库

**Q: AI回答不完整？**
A: 在AI设置中增加"最大令牌数"到4000以上

**Q: OCR识别不准确？**
A: 调整截图区域确保题目清晰，或切换OCR引擎

**Q: 适用于哪些题目？**
A: 特别适合诗词文学类题目，其他类型题目可通过AI服务回答

## 🔧 更新日志

### v2.1
- 全面统一主界面与设置面板的视觉风格，新增主题与复用组件体系
- 新增答案高亮区，首个 AI 回答可一眼看到，减少滚动
- 设置面板支持更友好的导航与卡片化布局
- 改善知识库查询性能并在退出时主动释放内存

### v2.0
- 重命名为"逆水寒殿试答题器"
- 优化诗词答案显示，突出关键信息
- 改进错误处理和稳定性
- 固定依赖版本，提升兼容性

## 📄 开源协议

本项目采用 MIT License 开源协议。

---
**祝您在逆水寒殿试中取得好成绩！** 🏆
